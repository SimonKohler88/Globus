from flask import Flask, Response, jsonify, render_template, request

# from video_server.video_preprocessor import process_videos, get_video_data
# from PIL import Image
# import numpy as np
import time
import os

print(f'Current WD: {os.getcwd()}')

import motordriver as mot_ctrl
import speeddriver
from GlobusServer import GlobusServer



globus = GlobusServer()


app = Flask(__name__)



@app.route('/')
def homepage():
   return render_template("HTML_fuer_Webserver.html")

@app.route('/motor_control', methods=['POST'])
def motor_control():
    motor_value = request.form.get('motor')
    speed_value = request.form.get('speed')

    if motor_value == "start":
        mot_ctrl.enable()
    if motor_value == "stop":
        mot_ctrl.disable()

    if speed_value == "up":
        speeddriver.up()
    if speed_value == "down":
        speeddriver.down()

    return render_template("HTML_fuer_Webserver.html")


@app.route('/frame/<int:delta_t_ms>')
def get_frame(delta_t_ms):
    pic = globus.get_frame(delta_t_ms)
    return Response(pic, mimetype='image/jpeg')

@app.route('/image_upload')
def image_upload():
   value = request.form['fileToUpload']
   globus.set_image(value)
   return render_template("HTML_fuer_Webserver.html")

@app.route('/back_to_video')
def back_to_video():
   globus.return_to_video()
   return render_template("HTML_fuer_Webserver.html")

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=80)
    # app.run(host = '192.168.137.1', port=8123)
