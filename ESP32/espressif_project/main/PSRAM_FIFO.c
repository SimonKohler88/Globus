/*
 * PSRAM_FIFO.c
 *
 *  Created on: 19.10.2024
 *      Author: skohl
 */

#include "PSRAM_FIFO.h"
#include "inttypes.h"

#include "esp_event.h"
#include "esp_heap_caps.h"
#include "esp_log.h"
#include "esp_system.h"
#include "freertos/FreeRTOS.h"
#include "freertos/queue.h"
#include "freertos/task.h"
#include "nvs_flash.h"

#include <string.h>

struct
{
    fifo_status_t* status;
    QueueHandle_t free_frames;
    QueueHandle_t ready_4_fpga_frames;

    fifo_frame_t current_frame_4_fpga;
    fifo_frame_t current_frame_from_rpi;
    uint8_t frame_2_fpga_in_progress;
    uint8_t frame_rpi_2_fifo_in_progress;
} typedef fifo_control_t;

static fifo_control_t fifo_control;

/* static memory allocation for Queues */
StaticQueue_t xQueueBuffer_free_frames;
uint8_t free_frames[ FIFO_NUMBER_OF_FRAMES * sizeof( fifo_frame_t ) ];
StaticQueue_t xQueueBuffer_frames_4_fpga;
uint8_t frames_4_fpga[ FIFO_NUMBER_OF_FRAMES * sizeof( fifo_frame_t ) ];

static const char* TAG = "fifo_ctrl";

fifo_frame_t static_pic_frame;
void copy_static_pic_to_PSRAM( uint8_t* start_ptr );

StaticSemaphore_t xMutexBuffer;
SemaphoreHandle_t xSemaphore = NULL;

void fifo_copy_mem_protected( void* dst_ptr, const void* src_ptr, uint32_t size )
{
    xSemaphoreTake( xSemaphore, portMAX_DELAY );
    memcpy( dst_ptr, src_ptr, size );
    xSemaphoreGive( xSemaphore );
}

void fifo_init( fifo_status_t* status )
{
    if ( status ) fifo_control.status = status;
    xSemaphore = xSemaphoreCreateMutexStatic( &xMutexBuffer );

    uint32_t frame_size_bytes = IMAGE_MAX_PIXEL_HEIGHT * IMAGE_MAX_PIXEL_WIDTH * IMAGE_BYTES_PER_PIXEL;

    // Padding space to be dividable by 4
    frame_size_bytes += frame_size_bytes % 4;

    /* Create Freertos queues. threadsafe fifo  */
    fifo_control.free_frames = xQueueCreateStatic( FIFO_NUMBER_OF_FRAMES, sizeof( fifo_frame_t ), &free_frames[ 0 ], &xQueueBuffer_free_frames );
    fifo_control.ready_4_fpga_frames =
        xQueueCreateStatic( FIFO_NUMBER_OF_FRAMES, sizeof( fifo_frame_t ), &frames_4_fpga[ 0 ], &xQueueBuffer_frames_4_fpga );

    for ( int i = 0; i < FIFO_NUMBER_OF_FRAMES; i++ )
    {
        uint8_t* frame_ptr = heap_caps_malloc( frame_size_bytes, MALLOC_CAP_SPIRAM );
        if ( frame_ptr != NULL )
        {
            fifo_frame_t frame;
            frame.frame_start_ptr = frame_ptr;
            frame.current_ptr     = frame_ptr;
            xQueueSend( fifo_control.free_frames, &frame, 0 );
            fifo_control.status->free_frames++;
            ESP_LOGI( TAG, "Allocated Frame Buffer %" PRIu8 " , size %" PRIu32 " Bytes", i, frame_size_bytes );
        }
        else ESP_LOGE( TAG, "Failed to allocate PSRAM Memory, frame %d", i );
    }
    fifo_update_stats();

    uint8_t* frame_ptr = heap_caps_malloc( frame_size_bytes, MALLOC_CAP_SPIRAM );
    if ( frame_ptr != NULL )
    {
        static_pic_frame.frame_start_ptr = frame_ptr;
        static_pic_frame.current_ptr     = frame_ptr;
        static_pic_frame.total_size      = frame_size_bytes;
        static_pic_frame.size            = 0;
        ESP_LOGI( TAG, "Allocated Static Frame Buffer size %" PRIu32 " Bytes", frame_size_bytes );

        copy_static_pic_to_PSRAM( frame_ptr );
    }
}

uint8_t fifo_has_frame_4_fpga( void ) { return uxQueueMessagesWaiting( fifo_control.ready_4_fpga_frames ); }

uint8_t fifo_is_frame_2_fpga_in_progress( void ) { return fifo_control.frame_2_fpga_in_progress; }

fifo_frame_t* fifo_get_frame_4_fpga( void )
{
    if ( fifo_control.frame_2_fpga_in_progress == 1 ) return NULL;
    ESP_LOGI( "FIFO", "fifo_get_frame_for_fpga " );

    uint8_t has_frame = xQueueReceive( fifo_control.ready_4_fpga_frames, &fifo_control.current_frame_4_fpga, 0 );
    if ( has_frame == pdFALSE ) return NULL;

    fifo_control.frame_2_fpga_in_progress = 1;

    fifo_update_stats();
    return &fifo_control.current_frame_4_fpga;
}

void fifo_mark_frame_4_fpga_done( void )
{
    /* from QSPI task */
    if ( fifo_control.frame_2_fpga_in_progress )
    {
        fifo_control.current_frame_4_fpga.current_ptr = fifo_control.current_frame_4_fpga.frame_start_ptr;
        fifo_control.current_frame_4_fpga.size        = 0;
        xQueueSend( fifo_control.free_frames, &fifo_control.current_frame_4_fpga, 0 );
        fifo_control.frame_2_fpga_in_progress = 0;

        fifo_update_stats();
    }
}

uint8_t fifo_has_free_frame( void ) { return uxQueueMessagesWaiting( fifo_control.free_frames ); }

fifo_frame_t* fifo_get_free_frame( void )
{
    if ( fifo_control.frame_rpi_2_fifo_in_progress == 1 ) return NULL;

    uint8_t has_frame = xQueueReceive( fifo_control.free_frames, &fifo_control.current_frame_from_rpi, 0 );
    if ( has_frame == pdFALSE ) return NULL;

    fifo_control.frame_rpi_2_fifo_in_progress = 1;

    fifo_update_stats();

    return &fifo_control.current_frame_from_rpi;
}

void fifo_return_free_frame( void )
{
    xQueueSend( fifo_control.free_frames, &fifo_control.current_frame_from_rpi, 0 );
    fifo_control.frame_rpi_2_fifo_in_progress = 0;
    fifo_update_stats();
}

void fifo_mark_free_frame_done( void )
{
    ESP_LOGI( "FIFO", "fifo_mark_free_frame_done %d ", fifo_control.frame_rpi_2_fifo_in_progress );

    if ( fifo_control.frame_rpi_2_fifo_in_progress )
    {
        xQueueSend( fifo_control.ready_4_fpga_frames, &fifo_control.current_frame_from_rpi, 0 );
        fifo_control.frame_rpi_2_fifo_in_progress = 0;

        fifo_update_stats();
    }
}

void fifo_update_stats( void )
{
    fifo_control.status->free_frames          = uxQueueMessagesWaiting( fifo_control.free_frames );
    fifo_control.status->ready_4_fpga_frames  = uxQueueMessagesWaiting( fifo_control.ready_4_fpga_frames );
    fifo_control.status->current_frame_2_esp  = fifo_control.frame_rpi_2_fifo_in_progress;
    fifo_control.status->current_frame_2_fpga = fifo_control.frame_2_fpga_in_progress;
}

fifo_frame_t* fifo_get_static_frame( void ) { return &static_pic_frame; }

void copy_static_pic_to_PSRAM( uint8_t* start_ptr )
{
    /* Copy from code directly to PSRAM, So it does not use Stack */
    memcpy(
        start_ptr,
        ( uint8_t[] ) {
            0x21, 0x93, 0xd8, 0x22, 0x93, 0xda, 0x22, 0x93, 0xdc, 0x24, 0x94, 0xdf, 0x25, 0x94, 0xe1, 0x25, 0x93, 0xe2, 0x21, 0x94, 0xe2, 0x1e, 0x93,
            0xe0, 0x1f, 0x96, 0xe0, 0x21, 0x98, 0xdf, 0x20, 0x98, 0xdd, 0x20, 0x98, 0xdc, 0x20, 0x96, 0xda, 0x21, 0x94, 0xdb, 0x20, 0x92, 0xda, 0x1f,
            0x92, 0xd9, 0x1f, 0x91, 0xd9, 0x20, 0x93, 0xda, 0x1f, 0x92, 0xd9, 0x1e, 0x94, 0xd9, 0x20, 0x96, 0xd9, 0x1e, 0x93, 0xd7, 0x1d, 0x93, 0xd6,
            0x1d, 0x93, 0xd6, 0x1b, 0x91, 0xd5, 0x1a, 0x8f, 0xd1, 0x19, 0x8f, 0xcf, 0x1a, 0x8f, 0xcf, 0x19, 0x8d, 0xcd, 0x18, 0x8d, 0xcc, 0x17, 0x8c,
            0xcb, 0x17, 0x8c, 0xca, 0x17, 0x8d, 0xc8, 0x1c, 0x92, 0xcc, 0x20, 0x96, 0xd0, 0x22, 0x98, 0xd2, 0x22, 0x98, 0xd2, 0x21, 0x97, 0xd1, 0x1e,
            0x98, 0xd6, 0x1b, 0x96, 0xd9, 0x1b, 0x95, 0xd8, 0x1e, 0x98, 0xd9, 0x21, 0x99, 0xd9, 0x21, 0x98, 0xd7, 0x23, 0x97, 0xd5, 0x23, 0x95, 0xd2,
            0x23, 0x94, 0xd1, 0x23, 0x94, 0xd1, 0x26, 0x96, 0xd3, 0x27, 0x97, 0xd3, 0x27, 0x97, 0xd4, 0x28, 0x99, 0xd7, 0x29, 0x99, 0xd8, 0x2a, 0x9a,
            0xd8, 0x29, 0x99, 0xd6, 0x27, 0x96, 0xd2, 0x27, 0x95, 0xd1, 0x26, 0x97, 0xd3, 0x23, 0x99, 0xd4, 0x23, 0x99, 0xd5, 0x25, 0x9a, 0xd7, 0x24,
            0x9a, 0xd6, 0x27, 0x9d, 0xd9, 0x28, 0x9e, 0xda, 0x27, 0xa0, 0xde, 0x28, 0xa1, 0xdf, 0x27, 0xa1, 0xe0, 0x28, 0xa0, 0xe1, 0x2c, 0xa4, 0xe5,
            0x30, 0xa7, 0xe9, 0x32, 0xa9, 0xed, 0x31, 0xa8, 0xee, 0x2e, 0xa5, 0xec, 0x2d, 0xa3, 0xea, 0x2e, 0xa4, 0xea, 0x2e, 0xa3, 0xe8, 0x2f, 0xa3,
            0xe7, 0x2d, 0xa2, 0xdf, 0x29, 0xa1, 0xe2, 0x25, 0x9f, 0xe3, 0x23, 0x9c, 0xdf, 0x23, 0x98, 0xd9, 0x22, 0x93, 0xd1, 0x24, 0x8f, 0xd3, 0x24,
            0x8f, 0xd6, 0x20, 0x90, 0xd6, 0x1d, 0x92, 0xd9, 0x1d, 0x96, 0xde, 0x17, 0x93, 0xdd, 0x1a, 0x94, 0xe0, 0x1a, 0x91, 0xe0, 0x19, 0x91, 0xe1,
            0x18, 0x90, 0xe2, 0x19, 0x91, 0xe5, 0x18, 0x93, 0xe6, 0x13, 0x90, 0xe4, 0x12, 0x8f, 0xe1, 0x13, 0x93, 0xe8, 0x10, 0x95, 0xed, 0x0d, 0x95,
            0xef, 0x0f, 0x96, 0xf1, 0x10, 0x96, 0xef, 0x10, 0x92, 0xee, 0x11, 0x91, 0xf0, 0x11, 0x91, 0xef, 0x10, 0x90, 0xee, 0x10, 0x90, 0xee, 0x0f,
            0x8f, 0xed, 0x0f, 0x8e, 0xed, 0x10, 0x8d, 0xed, 0x11, 0x8d, 0xed, 0x13, 0x8c, 0xec, 0x13, 0x8b, 0xeb, 0x12, 0x8c, 0xea, 0x11, 0x8c, 0xea,
            0x15, 0x8a, 0xeb, 0x14, 0x8a, 0xea, 0x0f, 0x8b, 0xea, 0x0e, 0x8b, 0xeb, 0x10, 0x89, 0xec, 0x14, 0x87, 0xed, 0x12, 0x88, 0xeb, 0x0c, 0x8c,
            0xea, 0x0c, 0x8c, 0xea, 0x0d, 0x8b, 0xea, 0x0f, 0x8b, 0xeb, 0x10, 0x8b, 0xeb, 0x10, 0x8b, 0xeb, 0x0f, 0x89, 0xec, 0x0f, 0x89, 0xec, 0x10,
            0x89, 0xea, 0x12, 0x8a, 0xea, 0x12, 0x88, 0xe7, 0x13, 0x89, 0xe8, 0x12, 0x89, 0xe9, 0x12, 0x8a, 0xeb, 0x11, 0x89, 0xe9, 0x11, 0x89, 0xe8,
            0x12, 0x8a, 0xe8, 0x11, 0x8a, 0xe7, 0x11, 0x8a, 0xe9, 0x0e, 0x8a, 0xef, 0x0c, 0x89, 0xed, 0x0d, 0x8a, 0xeb, 0x0d, 0x8a, 0xe9, 0x0d, 0x8b,
            0xe8, 0x0d, 0x8a, 0xe6, 0x11, 0x86, 0xed, 0x12, 0x86, 0xee, 0x13, 0x87, 0xee, 0x13, 0x87, 0xec, 0x12, 0x87, 0xeb, 0x13, 0x87, 0xea, 0x12,
            0x87, 0xec, 0x10, 0x87, 0xee, 0x10, 0x87, 0xed, 0x12, 0x86, 0xec, 0x13, 0x86, 0xea, 0x16, 0x86, 0xea, 0x17, 0x87, 0xea, 0x11, 0x89, 0xe9,
            0x0e, 0x89, 0xe8, 0x0c, 0x88, 0xe9, 0x0a, 0x89, 0xec, 0x0a, 0x8a, 0xef, 0x09, 0x8a, 0xf1, 0x0c, 0x88, 0xef, 0x0f, 0x86, 0xeb, 0x12, 0x85,
            0xe8, 0x14, 0x85, 0xe6, 0x15, 0x87, 0xea, 0x10, 0x86, 0xeb, 0x0e, 0x86, 0xea, 0x10, 0x87, 0xe6, 0x10, 0x88, 0xe7, 0x0f, 0x87, 0xe8, 0x0e,
            0x88, 0xeb, 0x0c, 0x87, 0xed, 0x0c, 0x87, 0xee, 0x11, 0x84, 0xeb, 0x14, 0x83, 0xec, 0x12, 0x81, 0xeb, 0x14, 0x83, 0xee, 0x13, 0x82, 0xef,
            0x14, 0x82, 0xf0, 0x12, 0x85, 0xec, 0x0f, 0x86, 0xe6, 0x10, 0x86, 0xe6, 0x11, 0x85, 0xe6, 0x12, 0x86, 0xe6, 0x14, 0x86, 0xe6, 0x14, 0x85,
            0xe6, 0x10, 0x87, 0xe4, 0x0f, 0x88, 0xe4, 0x0e, 0x88, 0xe6, 0x0d, 0x88, 0xe7, 0x0d, 0x89, 0xe9, 0x0d, 0x8a, 0xeb, 0x0e, 0x89, 0xee, 0x0f,
            0x88, 0xf1, 0x10, 0x88, 0xf1, 0x10, 0x88, 0xf0, 0x10, 0x89, 0xf0, 0x10, 0x89, 0xef, 0x10, 0x89, 0xec, 0x0f, 0x89, 0xe5, 0x0f, 0x89, 0xe4,
            0x10, 0x88, 0xe4, 0x11, 0x88, 0xe4, 0x12, 0x88, 0xe4, 0x12, 0x87, 0xe4, 0x13, 0x88, 0xe7, 0x13, 0x88, 0xe7, 0x13, 0x89, 0xe5, 0x11, 0x8a,
            0xe2, 0x12, 0x8d, 0xe1, 0x13, 0x8f, 0xe1, 0x16, 0x8e, 0xe5, 0x1b, 0x8f, 0xed, 0x1c, 0x90, 0xeb, 0x1c, 0x90, 0xe8, 0x1e, 0x92, 0xe5, 0x23,
            0x98, 0xe7, 0x28, 0x9c, 0xe8, 0x28, 0x9e, 0xe6, 0x27, 0x9d, 0xeb, 0x23, 0x99, 0xee, 0x21, 0x98, 0xec, 0x1f, 0x95, 0xe7, 0x1f, 0x96, 0xe3,
            0x1e, 0x96, 0xdd, 0x1c, 0x94, 0xd8, 0x1d, 0x93, 0xda, 0x1e, 0x94, 0xdb, 0x1e, 0x93, 0xdd, 0x1f, 0x92, 0xdd, 0x1e, 0x92, 0xde, 0x1b, 0x92,
            0xdf, 0x1a, 0x8e, 0xd9, 0x1b, 0x8b, 0xd4, 0x1c, 0x8c, 0xd5, 0x19, 0x8a, 0xd6, 0x16, 0x8a, 0xd7, 0x18, 0x8a, 0xd3, 0x19, 0x8a, 0xd2, 0x1a,
            0x8b, 0xd3, 0x1a, 0x8a, 0xd3, 0x1a, 0x8a, 0xd2, 0x19, 0x8a, 0xd2, 0x19, 0x8b, 0xd4, 0x1a, 0x8e, 0xd8, 0x1b, 0x8f, 0xd9, 0x1c, 0x91, 0xdb,
            0x1d, 0x93, 0xde, 0x1d, 0x93, 0xdf, 0x1d, 0x93, 0xdf, 0x12, 0x92, 0xd6, 0x11, 0x91, 0xd5, 0x11, 0x91, 0xd4, 0x11, 0x90, 0xd3, 0x12, 0x91,
            0xd4, 0x13, 0x92, 0xd5, 0x13, 0x93, 0xdb, 0x12, 0x91, 0xdc, 0x11, 0x91, 0xda, 0x13, 0x92, 0xda, 0x15, 0x95, 0xdb, 0x16, 0x97, 0xdb, 0x17,
            0x96, 0xda, 0x19, 0x97, 0xda, 0x19, 0x97, 0xda, 0x19, 0x96, 0xda, 0x19, 0x97, 0xdb, 0x1b, 0x99, 0xdd, 0x19, 0x98, 0xdc, 0x1b, 0x9d, 0xe1,
            0x1c, 0x9f, 0xe3, 0x1d, 0xa0, 0xe4, 0x1d, 0xa1, 0xe4, 0x1f, 0xa2, 0xe5, 0x22, 0xa5, 0xe9, 0x23, 0xa6, 0xe9, 0x24, 0xa6, 0xe7, 0x25, 0xa6,
            0xe7, 0x26, 0xa5, 0xe5, 0x27, 0xa4, 0xe3, 0x29, 0xa6, 0xe2, 0x2a, 0xa7, 0xe4, 0x24, 0xab, 0xee, 0x26, 0xaf, 0xf3, 0x27, 0xb0, 0xf5, 0x28,
            0xb1, 0xf5, 0x25, 0xae, 0xf3, 0x26, 0xaf, 0xf3, 0x2b, 0xb0, 0xed, 0x2f, 0xaf, 0xe7, 0x2f, 0xad, 0xe5, 0x2d, 0xaa, 0xe0, 0x2b, 0xa8, 0xdd,
            0x29, 0xa5, 0xda, 0x28, 0xa2, 0xd5, 0x26, 0x9f, 0xcc, 0x24, 0x9d, 0xcb, 0x23, 0x9b, 0xcb, 0x28, 0x9f, 0xd0, 0x2e, 0xa4, 0xd7, 0x2e, 0xa3,
            0xd7, 0x2d, 0xa3, 0xd4, 0x2d, 0xa3, 0xd3, 0x2c, 0xa3, 0xd3, 0x2c, 0xa2, 0xd2, 0x2c, 0xa2, 0xd2, 0x2c, 0xa2, 0xd3, 0x2f, 0xa3, 0xd1, 0x35,
            0xa2, 0xcd, 0x37, 0xa5, 0xd1, 0x38, 0xa7, 0xd5, 0x37, 0xa8, 0xd6, 0x37, 0xaa, 0xd9, 0x37, 0xa9, 0xd9, 0x34, 0xa7, 0xd1, 0x31, 0xa3, 0xcd,
            0x2c, 0xa0, 0xca, 0x2b, 0x9f, 0xc9, 0x2c, 0xa1, 0xcb, 0x2c, 0xa1, 0xcb, 0x29, 0xa2, 0xcb, 0x28, 0xa5, 0xcd, 0x2b, 0xa6, 0xce, 0x2e, 0xa9,
            0xd0, 0x30, 0xa9, 0xcf, 0x36, 0xae, 0xd3, 0x36, 0xad, 0xd4, 0x35, 0xac, 0xd8, 0x3a, 0xb3, 0xe1, 0x3d, 0xb8, 0xe7, 0x3f, 0xb8, 0xe6, 0x47,
            0xbb, 0xe6, 0x4f, 0xbf, 0xe6, 0x46, 0xc4, 0xe4, 0x46, 0xc8, 0xe6, 0x4a, 0xc9, 0xea, 0x4f, 0xc9, 0xed, 0x50, 0xc5, 0xed, 0x4c, 0xbd, 0xe6,
            0x48, 0xb5, 0xe2, 0x42, 0xaf, 0xe0, 0x32, 0xa1, 0xd5, 0x2d, 0x9f, 0xd4, 0x2a, 0x9f, 0xd8, 0x20, 0x98, 0xd2, 0x19, 0x92, 0xcf, 0x13, 0x8d,
            0xd6, 0x16, 0x93, 0xe1, 0x16, 0x97, 0xe8, 0x16, 0x9a, 0xed, 0x1a, 0x9d, 0xf0, 0x1e, 0x9f, 0xf0, 0x1b, 0x9e, 0xef, 0x18, 0x9d, 0xef, 0x16,
            0x9a, 0xed, 0x12, 0x97, 0xe9, 0x11, 0x96, 0xe8, 0x10, 0x95, 0xe7, 0x10, 0x93, 0xe8, 0x10, 0x90, 0xef, 0x10, 0x8e, 0xef, 0x10, 0x8d, 0xed,
            0x0f, 0x8c, 0xeb, 0x0f, 0x8c, 0xea, 0x0f, 0x8a, 0xe9, 0x11, 0x88, 0xeb, 0x0f, 0x88, 0xeb, 0x0c, 0x88, 0xea, 0x0c, 0x88, 0xeb, 0x0e, 0x87,
            0xec, 0x11, 0x86, 0xed, 0x0f, 0x86, 0xed, 0x0a, 0x88, 0xed, 0x0b, 0x87, 0xed, 0x0c, 0x87, 0xed, 0x0e, 0x87, 0xee, 0x0f, 0x86, 0xee, 0x0f,
            0x86, 0xee, 0x0e, 0x88, 0xef, 0x0f, 0x88, 0xef, 0x10, 0x87, 0xed, 0x10, 0x86, 0xeb, 0x13, 0x88, 0xec, 0x13, 0x87, 0xeb, 0x12, 0x87, 0xef,
            0x0f, 0x85, 0xef, 0x10, 0x86, 0xf0, 0x10, 0x85, 0xef, 0x0e, 0x84, 0xed, 0x0e, 0x83, 0xec, 0x0e, 0x82, 0xec, 0x14, 0x83, 0xec, 0x16, 0x84,
            0xec, 0x14, 0x83, 0xe9, 0x15, 0x84, 0xe9, 0x14, 0x83, 0xe6, 0x14, 0x83, 0xe5, 0x10, 0x89, 0xe7, 0x0a, 0x88, 0xe4, 0x0a, 0x89, 0xe4, 0x0e,
            0x8e, 0xe9, 0x0e, 0x8f, 0xea, 0x0a, 0x8d, 0xe8, 0x0b, 0x8b, 0xe5, 0x0e, 0x89, 0xe4, 0x0f, 0x8b, 0xe4, 0x10, 0x8b, 0xe3, 0x0e, 0x8a, 0xe1,
            0x0e, 0x8a, 0xe0, 0x0e, 0x88, 0xdc, 0x19, 0x87, 0xd6, 0x1a, 0x88, 0xd6, 0x1a, 0x89, 0xd8, 0x15, 0x86, 0xd6, 0x14, 0x86, 0xd9, 0x16, 0x88,
            0xdc, 0x12, 0x8e, 0xe1, 0x0f, 0x8f, 0xe2, 0x0f, 0x8a, 0xdc, 0x0e, 0x85, 0xd7, 0x11, 0x87, 0xd9, 0x13, 0x8b, 0xdf, 0x12, 0x8b, 0xe1, 0x18,
            0x8c, 0xdf, 0x13, 0x88, 0xdb, 0x13, 0x87, 0xdb, 0x13, 0x88, 0xdc, 0x14, 0x88, 0xdc, 0x10, 0x85, 0xd9, 0x0f, 0x8c, 0xdd, 0x0e, 0x8e, 0xe0,
            0x0b, 0x8b, 0xdd, 0x0b, 0x8a, 0xdf, 0x0b, 0x8a, 0xe1, 0x0a, 0x89, 0xe0, 0x07, 0x86, 0xe5, 0x05, 0x84, 0xed, 0x06, 0x84, 0xed, 0x08, 0x84,
            0xed, 0x0a, 0x84, 0xee, 0x0b, 0x84, 0xee, 0x0b, 0x83, 0xee, 0x0e, 0x83, 0xea, 0x0f, 0x83, 0xeb, 0x0f, 0x83, 0xec, 0x0f, 0x82, 0xed, 0x0f,
            0x82, 0xef, 0x11, 0x83, 0xf0, 0x10, 0x85, 0xed, 0x0f, 0x86, 0xea, 0x0f, 0x86, 0xe9, 0x0f, 0x85, 0xe8, 0x0e, 0x85, 0xe8, 0x0e, 0x86, 0xe8,
            0x0f, 0x85, 0xe8, 0x0f, 0x85, 0xeb, 0x0d, 0x83, 0xe9, 0x0c, 0x81, 0xe7, 0x0d, 0x81, 0xe8, 0x0e, 0x81, 0xe8, 0x0f, 0x80, 0xe7, 0x10, 0x86,
            0xe3, 0x12, 0x89, 0xe2, 0x15, 0x8c, 0xe3, 0x16, 0x8e, 0xe3, 0x1b, 0x93, 0xe5, 0x1a, 0x93, 0xe3, 0x17, 0x8e, 0xd7, 0x1c, 0x93, 0xd0, 0x24,
            0x9c, 0xd7, 0x26, 0x9e, 0xd6, 0x24, 0x9d, 0xd1, 0x2c, 0xa4, 0xd5, 0x36, 0xae, 0xdc,
        },
        92160 );

    ESP_LOGI( TAG, "Copied Data to ADDR %" PRIx32, ( uint32_t ) start_ptr );
}
